class GoDateFormatter{static format(e,t="2006-01-02"){if(!e)return"";const o=e instanceof Date?e:new Date(e);if(isNaN(o.getTime()))return console.warn("Invalid date provided to GoDateFormatter"),"";let s="",n=0;for(;n<t.length;){let e=!1,i=Math.min(10,t.length-n);for(let a=i;a>0;a--){const c=t.substring(n,n+a),r=this.#getFormatValue(c,o);if(r!==null){s+=r,n+=a,e=!0;break}}e||(s+=t[n],n++)}return s}static#getFormatValue(e,t){switch(e){case"2006":return t.getFullYear().toString().padStart(4,"0");case"06":return t.getFullYear().toString().slice(-2).padStart(2,"0");case"January":return t.toLocaleDateString("en-US",{month:"long"});case"Jan":return t.toLocaleDateString("en-US",{month:"short"});case"01":return(t.getMonth()+1).toString().padStart(2,"0");case"1":return(t.getMonth()+1).toString();case"02":return t.getDate().toString().padStart(2,"0");case"2":return t.getDate().toString();case"_2":return t.getDate().toString().padStart(2," ");case"Monday":return t.toLocaleDateString("en-US",{weekday:"long"});case"Mon":return t.toLocaleDateString("en-US",{weekday:"short"});case"15":return t.getHours().toString().padStart(2,"0");case"03":return(t.getHours()%12||12).toString().padStart(2,"0");case"3":return(t.getHours()%12||12).toString();case"04":return t.getMinutes().toString().padStart(2,"0");case"4":return t.getMinutes().toString();case"05":return t.getSeconds().toString().padStart(2,"0");case"5":return t.getSeconds().toString();case".000000000":return"."+(t.getMilliseconds()*1e6).toString().padStart(9,"0");case".000000":return"."+(t.getMilliseconds()*1e3).toString().padStart(6,"0");case".000":return"."+t.getMilliseconds().toString().padStart(3,"0");case".999999999":{const e=t.getMilliseconds();return e?"."+(e*1e6).toString().replace(/0+$/,""):""}case".999999":{const e=t.getMilliseconds();return e?"."+(e*1e3).toString().replace(/0+$/,""):""}case".999":{const e=t.getMilliseconds();return e?"."+e.toString().replace(/0+$/,""):""}case"PM":return t.getHours()>=12?"PM":"AM";case"pm":return t.getHours()>=12?"pm":"am";case"Z07:00":{const e=this.#getTimezoneOffset(t);return e==="+00:00"?"Z":e}case"Z0700":{const e=this.#getTimezoneOffsetNoColon(t);return e==="+0000"?"Z":e}case"-07:00":return this.#getTimezoneOffset(t);case"-0700":return this.#getTimezoneOffsetNoColon(t);case"-07":return this.#getTimezoneHour(t);case"MST":try{const e=new Intl.DateTimeFormat("en-US",{timeZoneName:"short"}).formatToParts(t);return e.find(e=>e.type==="timeZoneName")?.value||""}catch{return""}default:return null}}static#getTimezoneOffset(e){const t=-e.getTimezoneOffset(),s=t>=0?"+":"-",n=Math.abs(t),o=Math.floor(n/60).toString().padStart(2,"0"),i=(n%60).toString().padStart(2,"0");return s+o+":"+i}static#getTimezoneOffsetNoColon(e){const t=-e.getTimezoneOffset(),s=t>=0?"+":"-",n=Math.abs(t),o=Math.floor(n/60).toString().padStart(2,"0"),i=(n%60).toString().padStart(2,"0");return s+o+i}static#getTimezoneHour(e){const t=-e.getTimezoneOffset(),n=t>=0?"+":"-",s=Math.floor(Math.abs(t)/60).toString().padStart(2,"0");return n+s}}class I18N{#translations=new Map;#currentLang="en";#defaultLang="en";#defaultTranslations={};#availableLanguages=new Set(["en"]);#config={};#debug=!1;#initialized=!1;#cachePrefix="i18n_cache_";#buildHashKey="i18n_build_hash";#loaded=!1;constructor(e={}){const{debug:t=!1}=e;this.#debug=t,this.#init()}async#init(e=null){this.#loaded=!1;try{const t=await this.#loadWithCache();this.#config=t.config??{},this.#availableLanguages=new Set(t.language?.available??["en"]),this.#defaultLang=t.language?.current??"en",this.#defaultTranslations=t.translations??{};const n=e??this.#defaultLang;return this.#currentLang=this.#availableLanguages.has(n)?n:this.#defaultLang,await this.#loadTranslations(this.#currentLang),this.#initialized=!0,this.#debug&&this.#logDebug("i18n initialized",{language:this.#currentLang,defaultLanguage:this.#defaultLang,availableLanguages:[...this.#availableLanguages],translationsCount:this.#translations.size,config:this.#config}),this.#dispatchEvent("i18n:ready",{language:this.#currentLang,availableLanguages:[...this.#availableLanguages]}),!0}catch(e){return console.error("i18n initialization failed:",e),this.#initialized=!1,!1}finally{this.#loaded=!0}}async#loadWithCache(e){const n=!e||e===this.#defaultLang,c=n?"/i18n/i18n.json":`/${e}/i18n/i18n.json`,s=n?"default":`lang_${e}`,t=window.BUILD_HASH,o=localStorage.getItem(this.#buildHashKey),i=this.#cachePrefix+s;t!==o&&(this.#debug&&this.#logDebug("BUILD_HASH changed, clearing cache",{old:o,new:t}),this.#clearAllCache(),localStorage.setItem(this.#buildHashKey,t));const a=this.#getCachedData(i);if(a)return this.#debug&&this.#logDebug("Loading from cache",{targetLang:e||"default",cacheKey:s}),a;const r=await this.#fetchJSON(c);return this.#setCachedData(i,r),r}#getCachedData(e){try{const t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(e){console.warn("Failed to read cache:",e)}return null}#setCachedData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(n){if(console.warn("Failed to save cache:",n),n.name==="QuotaExceededError"){this.#clearAllCache();try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error("Failed to save cache after cleanup:",e)}}}}#clearAllCache(){const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&n.startsWith(this.#cachePrefix)&&e.push(n)}e.forEach(e=>localStorage.removeItem(e))}async#loadTranslations(e){if(e===this.#defaultLang){this.#setTranslations(this.#defaultTranslations);return}try{const t=await this.#loadWithCache(e);this.#setTranslations(t.translations??{})}catch{console.warn(`Failed to load ${e} translations, falling back to default`),this.#currentLang=this.#defaultLang,this.#setTranslations(this.#defaultTranslations)}}async#fetchJSON(e){const n=e.includes("?")?"&":"?",s=`${e}${n}hash=${window.BUILD_HASH}`,t=await fetch(s);if(!t.ok)throw new Error(`Failed to load: ${e}`);return t.json()}#setTranslations(e){this.#translations.clear(),Object.entries(e).forEach(([e,t])=>{this.#translations.set(e,t)})}#dispatchEvent(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))}#logDebug(e,t){this.#debug&&console.log(`[i18n] ${e}:`,t)}t=(e,t={})=>{if(!this.#loaded)return this.#debug&&console.warn(`i18n is loading, returning key: ${e}`),e;if(!this.#initialized)return console.warn("i18n not initialized yet"),e;const n=this.#translations.get(e);return n?Object.entries(t).reduce((e,[t,n])=>{const s=new RegExp(`{{\\s*${t}\\s*}}`,"g");return e.replace(s,String(n))},n):(this.#debug&&console.warn(`Translation missing for key: ${e}`),e)};switchLanguage=async e=>{if(e===this.#currentLang)return!0;if(!this.isLanguageAvailable(e))return console.warn(`Language '${e}' is not available. Available languages:`,[...this.#availableLanguages]),!1;this.#loaded=!1,this.#dispatchEvent("i18n:loading",{from:this.#currentLang,to:e});const n=this.#currentLang,t=await this.#init(e);return t&&this.#dispatchEvent("i18n:languageChanged",{from:n,to:e}),t};clearCache=()=>{this.#clearAllCache(),localStorage.removeItem(this.#buildHashKey),this.#debug&&this.#logDebug("Cache cleared")};isLoaded=()=>this.#loaded;getAvailableLanguages=()=>[...this.#availableLanguages];isLanguageAvailable=e=>this.#availableLanguages.has(e);getCurrentLanguage=()=>this.#currentLang;getDefaultLanguage=()=>this.#defaultLang;formatDate=(e,t)=>(t??=this.#config.dateFormat,GoDateFormatter.format(e,t));formatNumber=(e,t={})=>new Intl.NumberFormat(this.#currentLang,t).format(e);formatCurrency=(e,t="USD")=>this.formatNumber(e,{style:"currency",currency:t});formatPercent=(e,t=0)=>this.formatNumber(e,{style:"percent",minimumFractionDigits:t,maximumFractionDigits:t})}window.i18n=new I18N