window.MathJax={loader:{load:["input/tex","output/svg"]},tex:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]],processEscapes:!0},svg:{fontCache:"global"}},(()=>{"requestIdleCallback"in window||(window.requestIdleCallback=e=>{const t=Date.now();return setTimeout(()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})},1)}),"cancelIdleCallback"in window||(window.cancelIdleCallback=e=>clearTimeout(e))})();class Util{static trueRandom=e=>{const t=new Uint32Array(1);crypto.getRandomValues(t);const n=Math.floor(t[0]/4294967295*e);return n};static supportsStyleMap=typeof CSS!="undefined"&&CSS.supports&&"attributeStyleMap"in Element.prototype;static formatValue(e,t=""){if(typeof e!="number")return e;if(Number.isInteger(e))return e+t;const n=parseFloat(e.toFixed(3));return n+t}static createAttributeStyleMap(e){return this.supportsStyleMap?e.attributeStyleMap:{setProperty(t,n){e.style.setProperty(t,n)},removeProperty(t){e.style.removeProperty(t)},clean(){const t=getComputedStyle(e);for(const n of t)n.startsWith("--")&&e.style.removeProperty(n)}}}static deepMerge(e,t){const n=Object.assign({},e);return Util.isObject(e)&&Util.isObject(t)&&Object.keys(t).forEach(s=>{Util.isObject(t[s])?s in e?n[s]=Util.deepMerge(e[s],t[s]):Object.assign(n,{[s]:t[s]}):Object.assign(n,{[s]:t[s]})}),n}static isObject(e){return e&&typeof e=="object"&&!Array.isArray(e)}static generateId(){const e=Date.now().toString(36),t=Array.from({length:4},()=>Util.trueRandom(36).toString(36)).join("");return`${e}-${t}`}static generateImageName(){const e=Array.from({length:8},()=>Util.trueRandom(36).toString(36)).join(""),t=Date.now().toString(36);return`${e}${t}`}static getAnonymousId(){let e=null;try{e=localStorage.getItem("_anon_id")}catch{}if(!e){e="anon_"+Util.generateId();try{localStorage.setItem("_anon_id",e)}catch{try{sessionStorage.setItem("_anon_id",e)}catch{}}}return e}static getTimestamp(){return(new Date).getTime()}static safeStringify(e){try{return JSON.stringify(e)}catch{return"{}"}}static truncate(e,t=1e3){return e&&e.length>t?e.substring(0,t)+"...":e}static debounce(e,t){let n;return function(...s){const o=()=>{clearTimeout(n),e(...s)};clearTimeout(n),n=setTimeout(o,t)}}static throttle(e,t){let n;return function(...s){n||(e.apply(this,s),n=!0,setTimeout(()=>n=!1,t))}}static getCookie(e){const n=`; ${document.cookie}`,t=n.split(`; ${e}=`);return t.length===2?t.pop().split(";").shift():null}static setCookie(e,t,n=365){const s=new Date;s.setTime(s.getTime()+n*24*60*60*1e3);const o=`expires=${s.toUTCString()}`;document.cookie=`${e}=${t};${o};path=/;SameSite=Lax`}static deleteCookie(e){document.cookie=`${e}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`}static getQueryParam(e,t=window.location.href){e=e.replace(/[[\]]/g,"\\$&");const s=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=s.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}static hashCode(e){let t=0;if(e.length===0)return t;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=(t<<5)-t+s,t=t&t}return Math.abs(t)}static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}static getDeviceType(){const e=navigator.userAgent;return/tablet|ipad|playbook|silk/i.test(e)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"}static getBrowserInfo(){const e=navigator.userAgent;let t="Unknown",n="";return e.indexOf("Firefox")>-1?(t="Firefox",n=e.match(/Firefox\/(\d+)/)?.[1]||""):e.indexOf("Chrome")>-1?(t="Chrome",n=e.match(/Chrome\/(\d+)/)?.[1]||""):e.indexOf("Safari")>-1?(t="Safari",n=e.match(/Version\/(\d+)/)?.[1]||""):e.indexOf("Edge")>-1?(t="Edge",n=e.match(/Edge\/(\d+)/)?.[1]||""):(e.indexOf("MSIE")>-1||e.indexOf("Trident/")>-1)&&(t="IE",n=e.match(/(?:MSIE |rv:)(\d+)/)?.[1]||""),{browser:t,version:n}}static getOSInfo(){const e=navigator.userAgent;let n="Unknown",t="";return/Windows/.test(e)?(n="Windows",/Windows NT 10.0/.test(e)?t="10":/Windows NT 6.3/.test(e)?t="8.1":/Windows NT 6.2/.test(e)?t="8":/Windows NT 6.1/.test(e)&&(t="7")):/Mac OS X/.test(e)?(n="macOS",t=e.match(/Mac OS X (\d+[._]\d+)/)?.[1]?.replace("_",".")||""):/Android/.test(e)?(n="Android",t=e.match(/Android (\d+\.\d+)/)?.[1]||""):/iOS|iPhone|iPad|iPod/.test(e)?(n="iOS",t=e.match(/OS (\d+_\d+)/)?.[1]?.replace("_",".")||""):/Linux/.test(e)&&(n="Linux"),{os:n,version:t}}static formatFileSize(e){if(e===0)return"0 B";const t=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+s[n]}static getXPath(e){if(e.id)return`//*[@id="${e.id}"]`;const t=[];for(;e&&e.nodeType===Node.ELEMENT_NODE;){let s=0,n=e.previousSibling;for(;n;)n.nodeType===Node.ELEMENT_NODE&&n.nodeName===e.nodeName&&s++,n=n.previousSibling;const o=e.nodeName.toLowerCase(),i=s>0?`[${s+1}]`:"";t.unshift(`${o}${i}`),e=e.parentNode}return t.length?`/${t.join("/")}`:null}static getCssPath(e){if(!(e instanceof Element))return;const t=[];for(;e.nodeType===Node.ELEMENT_NODE;){let n=e.nodeName.toLowerCase();if(e.id){n+="#"+e.id,t.unshift(n);break}e.className&&typeof e.className=="string"&&(n+="."+e.className.trim().split(/\s+/).join("."));let s=e,o=1;for(;s.previousElementSibling;)s=s.previousElementSibling,s.nodeName.toLowerCase()===n.split(/[#.]/)[0]&&o++;if(o!==1&&(n+=`:nth-of-type(${o})`),t.unshift(n),e=e.parentElement,!e)break}return t.join(" > ")}static isInViewport(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}static getPerformanceMetrics(){if(!window.performance||!window.PerformanceNavigationTiming)return null;try{const e=performance.getEntriesByName(document.location.href,"navigation")[0];if(!e)return null;const t={dns:Math.round(e.domainLookupEnd-e.domainLookupStart),tcp:Math.round(e.connectEnd-e.connectStart),ttfb:Math.round(e.responseStart-e.requestStart),download:Math.round(e.responseEnd-e.responseStart),domParse:Math.round(e.domInteractive-e.responseEnd),domContentLoaded:Math.round(e.domContentLoadedEventEnd-e.domContentLoadedEventStart),domComplete:Math.round(e.domComplete-e.responseEnd),loadComplete:Math.round(e.loadEventEnd-e.loadEventStart),totalTime:Math.round(e.loadEventEnd-e.fetchStart),navigationType:e.type||"navigate",redirectTime:Math.round(e.redirectEnd-e.redirectStart),redirectCount:e.redirectCount||0,protocol:e.nextHopProtocol||"",encodedBodySize:e.encodedBodySize||0,decodedBodySize:e.decodedBodySize||0,transferSize:e.transferSize||0,firstPaint:0,firstContentfulPaint:0,largestContentfulPaint:0};if(performance.getEntriesByName)try{const e=performance.getEntriesByName("first-paint")[0],n=performance.getEntriesByName("first-contentful-paint")[0];e&&(t.firstPaint=Math.round(e.startTime)),n&&(t.firstContentfulPaint=Math.round(n.startTime))}catch{}if(window.PerformanceObserver&&PerformanceObserver.supportedEntryTypes?.includes("largest-contentful-paint"))try{const e=new PerformanceObserver(e=>{const n=e.getEntries();n.length>0&&(t.largestContentfulPaint=Math.round(n[n.length-1].startTime))});e.observe({entryTypes:["largest-contentful-paint"]}),setTimeout(()=>{e.disconnect()},5e3)}catch{}return Object.keys(t).forEach(e=>{typeof t[e]=="number"&&(t[e]<0||t[e]>6e4||isNaN(t[e]))&&(t[e]=0)}),t}catch(e){return console.warn("获取性能指标时出错:",e),null}}static getResourceMetrics(){if(!window.performance||!window.performance.getEntriesByType)return[];const e=performance.getEntriesByType("resource");return e.map(e=>({name:e.name,type:e.initiatorType,duration:Math.round(e.duration),size:e.transferSize||0,protocol:e.nextHopProtocol||"",startTime:Math.round(e.startTime),responseEnd:Math.round(e.responseEnd)}))}static getWebVitals(e){const t={FCP:null,LCP:null,FID:null,CLS:null,INP:null};if(!window.PerformanceObserver){e(t);return}try{const e=new PerformanceObserver(n=>{const o=n.getEntries(),s=o.find(e=>e.name==="first-contentful-paint");s&&(t.FCP=Math.round(s.startTime),e.disconnect())});e.observe({entryTypes:["paint"]})}catch{}try{let e=0;const n=new PerformanceObserver(t=>{const n=t.getEntries(),s=n[n.length-1];e=Math.round(s.startTime)});n.observe({entryTypes:["largest-contentful-paint"]}),["click","keydown","touchstart"].forEach(s=>{addEventListener(s,()=>{t.LCP=e,n.disconnect()},{once:!0,capture:!0})})}catch{}try{const e=new PerformanceObserver(n=>{const o=n.getEntries(),s=o[0];s&&(t.FID=Math.round(s.processingStart-s.startTime),e.disconnect())});e.observe({entryTypes:["first-input"]})}catch{}try{let e=0;const n=new PerformanceObserver(t=>{for(const n of t.getEntries())n.hadRecentInput||(e+=n.value)});n.observe({entryTypes:["layout-shift"]}),addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(t.CLS=Math.round(e*1e3)/1e3,n.disconnect())},{once:!0})}catch{}setTimeout(()=>e(t),3e3)}static getExperimentGroup(e,t=["control","variant"]){const n=Util.getAnonymousId(),s=Util.hashCode(n+e),o=s%t.length;return t[o]}}window.Util=Util;class LifeCycleManager{constructor(){this.handlers=[],window.addEventListener("beforeunload",()=>this.handleBeforeUnload())}register=e=>{this.handlers.push(e)};handleBeforeUnload=()=>{for(;this.handlers.length>0;){const e=this.handlers.pop();e()}}}window.LifeCycleManager=new LifeCycleManager;class PriorityScheduler{static Priority=Object.freeze({IMMEDIATE:"immediate",HIGH:"high",NORMAL:"normal",LOW:"low",IDLE:"idle"});static priorityOrder={[PriorityScheduler.Priority.IMMEDIATE]:0,[PriorityScheduler.Priority.HIGH]:1,[PriorityScheduler.Priority.NORMAL]:2,[PriorityScheduler.Priority.LOW]:3,[PriorityScheduler.Priority.IDLE]:4};static fakeIdleDeadline=Object.freeze({didTimeout:!1,timeRemaining:()=>1/0});constructor(){this._tasks=new Map}get Priority(){return PriorityScheduler.Priority}ensureDocumentReady=e=>{const t=Promise.all([new Promise(e=>{document.readyState==="complete"?e():document.readyState==="interactive"?window.addEventListener("load",e,{once:!0}):document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",()=>{document.readyState==="complete"?e():window.addEventListener("load",e,{once:!0})},{once:!0})}),Promise.race([this.delay(3e3),new Promise(e=>window?.i18n.isLoaded()?e():window.addEventListener("i18n:ready",e,{once:!0})).then(()=>{console.log("i18n:ready")})])]);if(typeof e=="function"){t.then(e);return}return t};wait=(e,t={})=>{const{priority:n,delay:s,timeout:o}=t;return new Promise((t,i)=>{try{const a=e=>{try{t(e?.timeRemaining?.()??1/0)}catch(e){i(e)}};this.schedule(e,a,{priority:n,delay:s,timeout:o})}catch(e){i(e)}})};delay=(e,t)=>new Promise(n=>setTimeout(()=>n(t),e));schedule=(e,t,n={})=>{const{priority:i=PriorityScheduler.Priority.NORMAL,delay:o=0,timeout:a=1/0}=n;this.cancel(e);const s={id:e,callback:t,priority:i,delay:o,timeout:a,type:"once"};switch(this._tasks.set(e,s),i){case PriorityScheduler.Priority.IMMEDIATE:s.handle=Promise.resolve().then(()=>{this._tasks.has(e)&&(t(PriorityScheduler.fakeIdleDeadline),this._tasks.delete(e))});break;case PriorityScheduler.Priority.HIGH:s.handle=requestAnimationFrame(()=>{this._tasks.has(e)&&(t(PriorityScheduler.fakeIdleDeadline),this._tasks.delete(e))});break;case PriorityScheduler.Priority.NORMAL:if(o===0)s.handle=requestAnimationFrame(()=>{this._tasks.has(e)&&(t(PriorityScheduler.fakeIdleDeadline),this._tasks.delete(e))});else{const i=performance.now(),n=a=>{a-i>=o?this._tasks.has(e)&&(t(PriorityScheduler.fakeIdleDeadline),this._tasks.delete(e)):s.handle=requestAnimationFrame(n)};s.handle=requestAnimationFrame(n)}break;case PriorityScheduler.Priority.LOW:s.timeout=Math.min(s.timeout,500);case PriorityScheduler.Priority.IDLE:s.handle=requestIdleCallback(n=>{this._tasks.has(e)&&(t(n),this._tasks.delete(e))},{timeout:s.timeout});break}return e};scheduleRepeating=(e,t,n,s={})=>{const{priority:a=PriorityScheduler.Priority.NORMAL,maxRuns:c=1/0}=s;this.cancel(e);const o={id:e,callback:t,priority:a,interval:n,type:"repeating",maxRuns:c,runCount:0};this._tasks.set(e,o);let i=performance.now();const r=()=>{const s=performance.now();if(a===PriorityScheduler.Priority.LOW||a===PriorityScheduler.Priority.IDLE)o.handle=requestIdleCallback(a=>{if(this._tasks.has(e)&&s-i>=n&&(t(a),i=s,o.runCount++,o.runCount>=o.maxRuns)){this._tasks.delete(e);return}this._tasks.has(e)&&r()});else{if(s-i>=n&&(t(PriorityScheduler.fakeIdleDeadline),i=s,o.runCount++,o.runCount>=o.maxRuns)){this._tasks.delete(e);return}this._tasks.has(e)&&(o.handle=requestAnimationFrame(r))}};return r(),e};scheduleBatch=e=>{const t=[...e].sort((e,t)=>{const n=e.priority||PriorityScheduler.Priority.NORMAL,s=t.priority||PriorityScheduler.Priority.NORMAL;return PriorityScheduler.priorityOrder[n]-PriorityScheduler.priorityOrder[s]});return t.map(e=>{const t=e.id||`batch_${Date.now()}_${Math.random()}`;return this.schedule(t,e.callback,e)})};scheduleBatchAsync=e=>{const t=[...e].sort((e,t)=>{const n=e.priority||PriorityScheduler.Priority.NORMAL,s=t.priority||PriorityScheduler.Priority.NORMAL;return PriorityScheduler.priorityOrder[n]-PriorityScheduler.priorityOrder[s]});return t.map(e=>{const t=e.id||`batch_${Date.now()}_${Math.random()}`;return this.wait(t,e)})};cancel=e=>{const t=this._tasks.get(e);if(!t)return;if(t.handle)switch(t.priority){case PriorityScheduler.Priority.HIGH:case PriorityScheduler.Priority.NORMAL:cancelAnimationFrame(t.handle);break;case PriorityScheduler.Priority.LOW:case PriorityScheduler.Priority.IDLE:cancelIdleCallback(t.handle);break}this._tasks.delete(e)};cancelAll=()=>{this._tasks.forEach((e,t)=>this.cancel(t))};getTaskCount=()=>this._tasks.size;hasTask=e=>this._tasks.has(e);getTask=e=>{const t=this._tasks.get(e);return t?{id:t.id,priority:t.priority,type:t.type,interval:t.interval}:null};getAllTaskIds=()=>Array.from(this._tasks.keys())}window.PriorityScheduler=new PriorityScheduler;class CacheManager{#db=null;#initPromise=null;#dbName="CacheDB";#storeName="cache";#expiry=24*60*60*1e3;#version="1.0.0";#buildHash="";#isSupported=!1;constructor(e={}){this.#dbName=e.dbName||this.#dbName,this.#storeName=e.storeName||this.#storeName,this.#expiry=e.expiry??this.#expiry,this.#version=e.version||this.#version,typeof window!="undefined"&&(this.#buildHash=e.buildHash||window.BUILD_HASH||"",this.#isSupported=this.#checkSupport(),this.#isSupported?this.#initPromise=this.#init():console.warn("IndexedDB not supported"),window.LifeCycleManager?.register(this.closeDatabase.bind(this)))}#checkSupport=()=>{try{return!!window.indexedDB}catch{return!1}};#init=async()=>new Promise((e,t)=>{const n=indexedDB.open(this.#dbName,3);n.onerror=()=>t(n.error),n.onsuccess=()=>{this.#db=n.result,this.#clearOldEntries().then(()=>{console.log(`CacheManager initialized (v${this.#version})`),e()})},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.#storeName)&&t.deleteObjectStore(this.#storeName);const n=t.createObjectStore(this.#storeName,{keyPath:"id"});n.createIndex("buildHash","buildHash",{unique:!1}),n.createIndex("version","version",{unique:!1}),n.createIndex("timestamp","timestamp",{unique:!1})}});#clearOldEntries=async()=>{if(!this.#db)return;return new Promise(e=>{const n=this.#db.transaction(this.#storeName,"readwrite"),s=n.objectStore(this.#storeName),t=s.openCursor();t.onsuccess=t=>{const n=t.target.result;if(n){const e=n.value;e&&(this.#compareVersions(e.version,this.#version)<0||e.buildHash!==this.#buildHash)&&n.delete(),n.continue()}else e()},t.onerror=()=>{console.error("清除旧缓存失败"),e()}})};#compareVersions=(e,t)=>{const n=(e||"0.0.0").split(".").map(Number),s=(t||"0.0.0").split(".").map(Number);for(let e=0;e<Math.max(n.length,s.length);e++){const t=n[e]||0,o=s[e]||0;if(t!==o)return t-o}return 0};#ensureReady=async()=>{if(!this.#isSupported)return!1;if(!this.#db)try{await this.#initPromise}catch(e){return console.error("数据库初始化失败",e),!1}return!!this.#db};#isEntryValid=e=>!!e&&e.buildHash===this.#buildHash&&!(this.#compareVersions(e.version,this.#version)<0)&&(this.#expiry<0||Date.now()-e.timestamp<=this.#expiry);async save(e,t){if(!await this.#ensureReady())return!1;try{const n=this.#db.transaction(this.#storeName,"readwrite"),s=n.objectStore(this.#storeName);return await new Promise((n,o)=>{const i=s.put({id:e,data:t,timestamp:Date.now(),buildHash:this.#buildHash,version:this.#version});i.onsuccess=n,i.onerror=()=>o(i.error)}),!0}catch(t){return console.error(`保存失败: ${e}`,t),!1}}async load(e){if(!await this.#ensureReady())return null;try{const n=this.#db.transaction(this.#storeName,"readonly"),s=n.objectStore(this.#storeName),t=await new Promise(t=>{const n=s.get(e);n.onsuccess=()=>t(n.result),n.onerror=()=>t(null)});return t&&this.#isEntryValid(t)?t.data:(t&&await this.delete(e),null)}catch(t){return console.error(`加载失败: ${e}`,t),null}}async delete(e){if(!await this.#ensureReady())return!1;try{const t=this.#db.transaction(this.#storeName,"readwrite"),n=t.objectStore(this.#storeName);return await new Promise((t,s)=>{const o=n.delete(e);o.onsuccess=t,o.onerror=()=>s(o.error)}),!0}catch(t){return console.error(`删除失败: ${e}`,t),!1}}async closeDatabase(){return!!this.#db&&(this.#db.close(),this.#db=null,!0)}getVersion(){return this.#version}async isValid(e){if(!await this.#ensureReady())return!1;try{const t=this.#db.transaction(this.#storeName,"readonly"),n=t.objectStore(this.#storeName),s=await new Promise(t=>{const s=n.get(e);s.onsuccess=()=>t(s.result),s.onerror=()=>t(null)});return this.#isEntryValid(s)}catch(t){return console.error(`验证失败: ${e}`,t),!1}}async getStats(){if(!await this.#ensureReady())return 0;try{const e=this.#db.transaction(this.#storeName,"readonly"),t=e.objectStore(this.#storeName);return await new Promise(e=>{const n=t.count();n.onsuccess=()=>e(n.result),n.onerror=()=>e(0)})}catch(e){return console.error("获取统计失败",e),0}}async getAllCacheEntries(){if(!await this.#ensureReady())return[];try{const e=this.#db.transaction(this.#storeName,"readonly"),t=e.objectStore(this.#storeName);return await new Promise(e=>{const n=t.getAll();n.onsuccess=()=>e(n.result||[]),n.onerror=()=>e([])})}catch(e){return console.error("获取所有缓存失败",e),[]}}}window.CacheManager=CacheManager